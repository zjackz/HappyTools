


# .NET Core 项目 AI 编程规范

## 核心理念
- **简洁优于复杂：** 优先选择最简单可行的方案。
- **AI 友好编程：** 代码结构清晰，便于 AI 理解和生成。
- **渐进式架构：** 从简单开始，按需增加复杂度。
- **约定优于配置：** 统一的项目结构和命名规范。

## 基本原则
- 使用简体中文交流。
- 文档存放位置：
  - 正式：`docs/`
  - 草案：`discuss/`
- 代码限制：
  - 单文件不超过 400 行。
  - 单目录不超过 8 个文件。
- **禁止过度设计：** 不要为了未来可能的需求增加当前复杂度。

## AI 协作编程指导
### 上下文管理
- **代码上下文：** 每次对话开始时，先提供相关的现有代码。
- **需求上下文：** 明确说明要解决的具体问题。
- **约束上下文：** 告知 AI 当前项目的技术栈和限制条件。
- **变更上下文：** 说明这次修改会影响哪些现有功能。
### 增量式开发
- **最小可行功能：** 每次只实现一个完整的小功能。
- **验证再继续：** 确保当前功能正常后再添加新功能。
- **代码检视：** AI 生成的代码需要人工检视关键逻辑。
- **分步实现：** 复杂功能拆解成多个独立步骤。
### 错误处理策略
- **编译错误优先：** 先解决编译问题再考虑逻辑问题。
- **明确错误信息：** 遇到错误时，完整提供错误堆栈给 AI。
- **回滚机制：** 保持代码随时可回滚到上一个工作状态。
- **问题隔离：** 一次只解决一个问题，避免多个问题混在一起。
## 代码协作规范
### AI 生成代码的验证
- **业务逻辑检查：** 验证生成的代码是否符合业务需求。
- **边界条件测试：** 检查空值、异常输入等边界情况。
- **性能考量：** 关注明显的性能问题（如 N+1 查询）。
- **安全检查：** 验证输入验证、SQL 注入等基本安全问题。
### 沟通效率
- **具体示例优于抽象描述：** 提供具体的输入输出示例。
- **代码片段优于文字描述：** 用现有代码说明期望的代码风格。
- **及时反馈：** 发现问题立即指出，不要累积。

## AI 提示词建议
### 请求代码时
- 请帮我实现 [具体功能]，要求：
  - 直接可运行的代码。
  - 包含必要的注释。
  - 遵循项目现有结构。
  - 不要过度抽象。
### 重构代码时
- 这段代码有什么问题？如何简化？
重构原则：
- 保持功能不变。
- 提高可读性。
- 不要增加不必要的复杂度。
---
## 代码可读性优先
- **明确的命名：** 类名、方法名、变量名要自解释。
- **单一职责：** 每个方法只做一件事。
- **线性逻辑：** 避免深层嵌套，优先使用卫语句。
- **显式优于隐式：** 明确表达意图，避免"聪明"的代码。
## AI 友好的项目结构
项目名.WebApi/          # 单一入口点，便于 AI 理解全貌
├── Controllers/        # API 控制器
├── Services/           # 业务逻辑服务
├── Models/             # 数据模型
├── Data/               # 数据访问
└── Program.cs          # 启动配置

## 技术选择指导
### 必须遵循
- **.NET 8+** 和 **Nullable Reference Types**。
- **依赖注入** 但不要过度抽象。
- **异步编程** 优于同步（I/O 操作）。
- **强类型** 优于弱类型。
- **实用主义：** 解决问题优于展示技巧。
### 避免过度抽象
- **不要为了一个实现创建接口。**
- **Repository 模式：** 除非有多种数据源，否则直接用 DbContext。
- **复杂设计模式：** 只有在解决实际问题时才引入。
- **过度配置化：** 不要让简单功能变成配置地狱。
### 数据访问原则
- 默认直接使用 Entity Framework DbContext。
- 简单查询直接写 LINQ。
- 复杂查询可以考虑原生 SQL。
- **何时抽象：** 当存在多种数据源时。
## 代码协作规范
### 文件组织原则
- **相关代码放在一起：** 宁可文件稍大，不要过度拆分。
- **功能内聚：** 一个功能的相关代码在同一目录。
- **避免深层目录：** 目录层级不超过 3 层。
### 方法设计
- **方法长度：** 优先保持逻辑完整性，而非严格行数限制。
- **参数数量：** 超过 3 个参数考虑对象包装。
- **返回值：** 明确的类型，避免 object 或 dynamic。
### 错误处理
- **异常使用：** 只对真正的错误使用异常。
- **业务错误：** 使用 Result<T> 或类似模式。
- **日志记录：** 关键路径和错误都要记录。
## 开发工作流
### 快速启动
- 项目必须有 `README.md` 说明如何启动。
- 一个命令启动开发环境。
- 数据库迁移自动化。
- **5 分钟规则：** 新开发者 5 分钟内能跑起项目。
### 配置管理
- **开发配置：** 直接写在 `appsettings.Development.json`。
- **生产配置：** 通过环境变量覆盖。
- **避免过度配置：** 不要让每个值都可配置。
### 测试策略
- **从集成测试开始：** 验证核心业务流程。
- **单元测试：** 只对复杂业务逻辑写单元测试。
- **避免测试膨胀：** 不要为了覆盖率而写无用测试。
## 特殊场景处理
### 什么时候增加复杂度
- **性能瓶颈：** 有实际性能问题时。
- **维护困难：** 代码已经难以理解和修改时。
- **需求变化：** 有明确的新需求时。
- **团队规模：** 多人协作出现冲突时。
### 重构信号
- 修改一个功能需要改动多个文件。
- 添加新功能需要理解大量无关代码。
- 测试难写或者经常因为无关修改而失败。
- 部署变得复杂或不稳定。

**指导思想：先让代码工作，再让代码优雅，最后让代码快速**


