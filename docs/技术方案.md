# 亚马逊热销品发现系统 - 技术方案文档 (精简版)

## 1. 项目概述

本项目旨在开发一个“亚马逊趋势数据仪表盘”。系统通过自动化数据采集、分析与可视化，帮助电商选品专家和卖家高效发现亚马逊美国站的热销产品和新兴趋势，以应对市场变化并抢占先机。

### 核心交付物

1.  **后端 API 服务**: 基于 .NET 8 构建的高性能数据服务。
2.  **交互式 API 文档**: 通过 Swagger UI 自动生成的、带完整注释的 API 手册。
3.  **后台管理脚手架**: 一个基于 Next.js 的、功能完备的前端管理界面，用于数据可视化和系统管理。

本文档将详细阐述后端系统架构、前后端技术选型、模块设计和部署策略。

## 2. 整体架构

为在项目初期实现快速开发与迭代，同时保证未来的可扩展性，我们采用 **模块化单体 (Modular Monolith)** 架构。

该架构将所有核心功能承载于一个统一的 **ASP.NET Core 应用**中，但在代码层面严格保持模块化划分。这种方式避免了微服务带来的早期复杂性，同时使得未来向微服务演进成为可能。

**核心流程:**

1.  **ASP.NET Core 主应用** 内置并启动 **Hangfire 服务**。
2.  Hangfire 按计划（如每日一次）触发一个**数据采集作业 (Scraping Job)**。
3.  该作业调用**核心业务逻辑层 (Core Library)** 中的 `ScrapingService` 来抓取数据。
4.  抓取成功后，直接在同一进程中调用 `AnalysisService` 进行数据清洗、分析和持久化。
5.  `AnalysisService` 使用 `AppDbContext` (EF Core) 将数据存入 **PostgreSQL 数据库**。
6.  **后台管理脚手架 (Next.js)** 通过主应用提供的 **API 控制器** 来查询和管理数据。

这种架构清晰、直接，易于开发和调试。

## 3. 技术选型

技术选型以精简、高效为原则，减少不必要的中间件依赖。

### 后端技术

- **运行时/框架:** .NET 8
- **主应用框架:** ASP.NET Core 8 Web API
- **API 文档:** Swashbuckle (Swagger) - 用于自动生成交互式 API 文档。
- **数据访问:** Entity Framework Core 8 (EF Core) - 作为 ORM 框架，简化数据库操作。
- **Web 抓取:**
    - `HttpClient`: 用于发送 HTTP 请求。
    - `HtmlAgilityPack`: 用于解析和操作 HTML 文档。
    - **备选方案:** `Puppeteer Sharp` (.NET 版 Puppeteer)，用于应对复杂的反爬虫场景。
- **后台任务与调度:** `Hangfire` - 用于管理和执行定时的数据采集任务。
    - **重要:** Hangfire 将配置为使用 **PostgreSQL** 作为其任务和状态的持久化存储，从而移除对 Redis 的硬性依赖。
- **数据库:** PostgreSQL - 功能强大的开源关系型数据库，同时服务于业务数据和 Hangfire。
- **缓存 (可选):** Redis - 用于对高频访问的 API 数据进行缓存，提升响应速度。在项目初期，也可以先使用内存缓存，将 Redis 作为后续的性能优化选项。
- **容器化:** Docker - 用于打包、分发和运行应用程序。

### 前端技术 (Admin 脚手架)

- **框架:** Next.js v15.4 (使用 App Router)
- **UI 库:** React v19
- **样式:** Tailwind CSS v4
- **数据请求:** SWR - 用于高效的数据获取和缓存。
- **图表库:** Recharts - 用于数据可视化。

## 4. 模块设计

我们将遵循“高内聚、低耦合”的原则，将解决方案划分为逻辑清晰的几个项目。

**解决方案项目结构:**

```
/AmazonTrendsSolution
|
|-- /src
|   |
|   |-- AmazonTrends.WebApp/      # 主应用：承载 API 和 Hangfire Server
|   |   |-- Controllers/          # API 接口
|   |   |-- Jobs/                 # Hangfire 的作业定义
|   |   |-- Program.cs            # 应用启动和所有服务配置
|   |
|   |-- AmazonTrends.Core/        # 核心业务逻辑 (类库)
|   |   |-- Services/             # 包含 Scraping, Analysis, Notification 等服务
|   |   |-- Dtos/                 # 数据传输对象
|   |
|   |-- AmazonTrends.Data/        # 数据访问层 (类库)
|   |   |-- Models/               # 数据库实体模型
|   |   |-- AppDbContext.cs       # EF Core 上下文
|   |
|   |-- AmazonTrends.AdminUI/     # 新增：后台管理脚手架 (Next.js)
|       |-- /app                  # Next.js App Router
|       |-- /components           # React 组件
|       |-- /lib                  # 工具函数和 SWR hooks
|       |-- package.json
|
|-- /scripts
|   |-- build.sh
|   |-- run-dev.sh
|
|-- docker-compose.yml
|-- AmazonTrends.sln
```

**模块职责:**

- **`AmazonTrends.Data`**: 最底层，只负责定义数据库模型和 `DbContext`，不包含业务逻辑。
- **`AmazonTrends.Core`**: 核心层，包含所有业务逻辑的实现，如数据抓取、趋势分析、通知发送等。它依赖 `Data` 层，但对 `WebApp` 层一无所知。
- **`AmazonTrends.WebApp`**: 应用层，是整个系统的入口。它负责：
    - 配置并启动所有服务（EF Core, Hangfire, 业务服务等）。
    - 定义 API 控制器，为前端提供数据接口。
    - 定义 Hangfire 作业，调度 `Core` 层中的服务来执行后台任务。
- **`AmazonTrends.AdminUI`**: **(新增)** 前端层，一个独立的 Next.js 应用。它通过调用 `WebApp` 提供的 API，为用户提供一个可视化的数据仪表盘和后台管理界面。

## 5. 部署方案

- **容器化:**
    - 为 `AmazonTrends.WebApp` 和 `AmazonTrends.AdminUI` 分别创建 `Dockerfile`。
    - 使用 `docker-compose.yml` 在本地或服务器上统一编排和启动所有服务（前端应用、后端应用、PostgreSQL 数据库，以及可选的 Redis）。
- **脚本化:**
    - 在项目根目录的 `scripts/` 文件夹下，创建 `build.sh` 和 `run-dev.sh` 等脚本，用于一键构建 Docker 镜像和启动开发环境。
- **环境配置:**
    - 使用 `appsettings.json` 和环境变量来管理不同环境（开发、生产）的配置。

## 6. 风险与挑战

- **反爬虫机制:** 依然是最大的技术挑战。解决方案是结合使用代理、User-Agent轮换和请求节流。
- **数据准确性:** 亚马逊页面结构可能变更，导致解析失败。需要实现监控和告警机制。
- **性能与扩展:** 当系统负载增加时，由于是单体应用，需要垂直扩展（增加服务器资源）。但因为代码是模块化的，未来可以平滑地将最耗资源的服务（如数据采集）重构为独立的微服务。

## 7. 开发规范

- **代码风格:** 遵循标准的 C#/.NET 和 TypeScript 编码规范。
- **项目结构:** 严格按照上述模块化方案组织项目。
- **代码行数:** 确保每个 C# 文件代码行数不超过 400 行，每个 TSX/TS 文件不超过 300 行。
- **文档:** 所有公开的 API 端点和核心方法都必须添加完整的 XML 或 JSDoc 注释。
- **测试:** 为核心业务逻辑（如趋势分析算法）和关键的 React 组件编写单元测试。
